# NIBS-BIDS proposal v5

I've been playing around with an alternative structure which combines the 
strengths of both current BIDS proposals. In this proposed structure, 
all nibs-related files will have a corresponding `_nibs.tsv` and `_nibs.json` 
file. A key difference is where the files are located.

## Online NIBS

Where NIBS is given during a corresponding neuroimaging/behavioural recording
and therefore has a neuroimaging/behavioural file, the `_nibs.tsv` and 
`_nibs.json` file will be stored in the corresponding data folder using the following
format:

`<matches>_nibs.json`
`<matches>_nibs.tsv`

This is similar to the format for [Physiological recording](https://bids-specification.readthedocs.io/en/stable/modality-specific-files/physiological-recordings.html)
and enables the file to be linked with other relevant files such as the 
`_events.tsv` which will describe the timing of the stimuli.

## Offline NIBS

Where NIBS doesn't have a corresponding data recording file (e.g., interventions 
or protocols like RMT and AMT that generate a stimulation intensity value),
the `_nibs.tsv` and `_nibs.json` files are stored in a dedicated `nibs` directory.
For protocols like RMT and AMT, the relevant value generated by these protocols
can be stored in the `_nibs.tsv` file. This is similar to  
[Behavioral experiments](https://bids-specification.readthedocs.io/en/stable/modality-specific-files/behavioral-experiments.html)
and also enables other relevant files like `_events.tsv` to be stored.

`sub-001_task-rmt_nibs.tsv`
`sub-001_task-rmt_nibs.json`

## `_nibs.json` files

Like our current proposal, I suggest that the `_nibs.json` files store 
information relevant to the NIBS hardware/software, coils/electrode/transducers, and
neuronavigation hardware/software, as well as describing the columns in the
`_nibs.tsv`.

## `_nibs.tsv` files

Like our current proposal, I suggest that we store information on stimulation intensity,
coil/electrode/transducer position, and other relevant stimulation parameters
(e.g., TMS pulse shape, direction) in this files. Importantly, `trial_types`
can be used to link this information with stimuli events recorded in the `_events.tsv`.

## `_events.tsv` and `_events.json`

As proposed, I suggest that we use these files to indicate the timing of the
NIBS events. For online recordings (e.g., EMG, EEG), these will already be 
coded with the relevant data recording files. For offline NIBS, we can have
`_events.tsv` files in the `nibs` directory. For interventions, this can 
indicate the beginning of the stimulation and the details of the stimulation
protocol.

I think this proposal strikes a balance between visibility and simplicity while also 
incorporating the differences between online and offline protocols.

Importantly, this framework provides a corresponding data file for all NIBS event
types (either online or offline) which can be described in a `_scans.tsv`
file allowing the full experiment to be represented.

## To summarise
* When stimulation occurs = `_events.tsv`
* Where stimulation occurs (coil/electrode/transducer position) = `_nibs.tsv`
* How stimulation occurs (intensity, pulse shape etc) = `_nibs.tsv`
* What devices are used = `_nibs.json`

* Online NIBS = store in corresponding data recording folder
* Offline NIBS = store in `nibs` directory